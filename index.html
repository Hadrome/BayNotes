<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
    .prose img { max-width: 100%; border-radius: 0.5rem; }
    .prose pre { background: #1e293b; color: white; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
</style>

<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-6">
    <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
            <input v-model="newTitle" placeholder="标题" class="w-full text-lg font-bold outline-none mb-2">
            <textarea v-model="newContent" placeholder="Markdown 内容..." rows="4" class="w-full resize-none text-slate-600 outline-none font-mono"></textarea>
        </div>
        <div class="flex-1 border-t md:border-t-0 md:border-l pt-4 md:pt-0 md:pl-4 overflow-y-auto max-h-40 prose prose-slate" v-html="previewHtml"></div>
    </div>
    <div class="flex justify-between items-center mt-3 pt-3 border-t">
        <label class="flex items-center gap-2 text-sm text-slate-500 cursor-pointer">
            <input type="checkbox" v-model="isEncrypted" class="rounded"> <i class="ph ph-lock-key"></i> 加密此笔记
        </label>
        <button @click="createNote" class="bg-slate-900 text-white px-6 py-2 rounded-full font-medium">保存</button>
    </div>
</div>

<div v-if="showShareModal" class="fixed inset-0 z-[100] bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2"><i class="ph ph-share-network"></i> 分享笔记</h3>
        <div class="space-y-4 text-sm">
            <div>
                <label class="block text-slate-400 mb-1">有效期</label>
                <select v-model="shareForm.days" class="w-full bg-slate-100 p-2.5 rounded-xl outline-none">
                    <option :value="0">永久有效</option>
                    <option :value="1">1 天</option>
                    <option :value="3">3 天</option>
                    <option :value="7">7 天</option>
                    <option :value="30">30 天</option>
                </select>
            </div>
            <div>
                <label class="block text-slate-400 mb-1">自定义访问密码</label>
                <input v-model="shareForm.pwd" placeholder="留空则不设密码" class="w-full bg-slate-100 p-2.5 rounded-xl outline-none">
            </div>
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" v-model="shareForm.burn"> 阅后即焚 (查看一次后链接失效)
            </label>
            <button @click="confirmShare" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">生成分享链接</button>
            
            <div v-if="generatedUrl" class="mt-4 p-3 bg-blue-50 border border-blue-100 rounded-xl">
                <p class="text-[10px] text-blue-400 uppercase font-bold mb-1">链接已生成</p>
                <p class="text-xs break-all select-all font-mono">{{ generatedUrl }}</p>
            </div>
        </div>
        <button @click="showShareModal = false" class="w-full mt-4 text-slate-400">取消</button>
    </div>
</div>
